// Code generated by hertz generator.

package departments

import (
	utils2 "admin/infras/utils"
	"admin/rpc/client"
	"common/pkg/errno"
	"common/pkg/utils"
	"context"
	base "gen/hertz_gen/base"
	"gen/hertz_gen/departments"
	base1 "gen/kitex_gen/base"
	user2 "gen/kitex_gen/user"

	"github.com/cloudwego/hertz/pkg/app"
)

// CreateDepartments .
// @router /service/departments/create [POST]
func CreateDepartments(ctx context.Context, c *app.RequestContext) {
	var err error
	var req departments.CreateDepartmentsReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}
	resp, err := client.UserClient.CreateDepartments(ctx, &user2.CreateDepartmentsReq{
		Name:      req.GetName(),
		ManagerId: req.GetManagerId(),
		ParentId:  req.GetParentId(),
		Desc:      req.GetDesc(),
		Status:    req.GetStatus(),
		CreatedId: utils2.GetTokenId(ctx, c),
	})

	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), resp, 0, "")
		return
	}
	utils.SendResponse(c, errno.Success, resp.Data, 0, "")
	return
}

// DeleteDepartments .
// @router /service/departments/delete [POST]
func DeleteDepartments(ctx context.Context, c *app.RequestContext) {
	var err error
	var req base.IdReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}

	resp, err := client.UserClient.DeleteDepartments(ctx, &base1.IdReq{Id: req.GetID()})

	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), resp, 0, "")
		return
	}
	utils.SendResponse(c, errno.Success, resp, 0, "")
	return
}

// UpdateDepartments .
// @router /service/departments/update [POST]
func UpdateDepartments(ctx context.Context, c *app.RequestContext) {
	var err error
	var req departments.UpdateDepartmentsReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}
	resp, err := client.UserClient.UpdateDepartments(ctx, &user2.UpdateDepartmentsReq{
		Id:        req.GetID(),
		Name:      req.GetName(),
		ManagerId: req.GetManagerId(),
		ParentId:  req.GetParentId(),
		Desc:      req.GetDesc(),
		Status:    req.GetStatus(),
		CreatedId: utils2.GetTokenId(ctx, c),
	})

	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}
	utils.SendResponse(c, errno.Success, resp, 0, "")
	return
}

// GetDepartments .
// @router /service/departments [POST]
func GetDepartments(ctx context.Context, c *app.RequestContext) {
	var err error
	var req base.IdReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}

	resp, err := client.UserClient.GetDepartments(ctx, &base1.IdReq{
		Id: req.GetID(),
	})

	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), resp, 0, "")
		return
	}
	utils.SendResponse(c, errno.Success, resp.Data, 0, "")
	return
}

// GetDepartmentsList .
// @router /service/departments/list [POST]
func GetDepartmentsList(ctx context.Context, c *app.RequestContext) {
	var err error
	var req departments.GetDepartmentsListReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}

	resp, err := client.UserClient.GetDepartmentsList(ctx, &user2.GetDepartmentsListReq{
		Page:     req.GetPage(),
		PageSize: req.GetPageSize(),
		Keyword:  req.GetKeyword(),
	})

	if err != nil {
		utils.SendResponse(c, errno.ConvertErr(err), resp, 0, "")
		return
	}
	utils.SendResponse(c, errno.Success, resp.Data, 0, "")
	return
}
