// Code generated by hertz generator.

package order

import (
	"admin/rpc/client"
	"common/pkg/errno"
	utils2 "common/pkg/utils"
	"context"
	base "gen/hertz_gen/base"
	order "gen/hertz_gen/order"
	base2 "gen/kitex_gen/base"
	order2 "gen/kitex_gen/order"

	"github.com/cloudwego/hertz/pkg/app"
)

// GetOrder .
// @router /service/order [POST]
func GetOrder(ctx context.Context, c *app.RequestContext) {
	var err error
	var req order.GetOrderReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}

	resp, err := client.OrderClient.GetOrder(ctx, &order2.GetOrderReq{
		Id: req.GetID(),
		Sn: req.GetSn(),
	})
	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}
	utils2.SendResponse(c, errno.Success, resp.Data, 0, "")
	return
}

// GetOrderList .
// @router /service/order/list [POST]
func GetOrderList(ctx context.Context, c *app.RequestContext) {
	var err error
	var req order.GetOrderListReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}

	resp, err := client.OrderClient.GetOrderList(ctx, &order2.GetOrderListReq{
		MemberId:  req.GetMemberId(),
		CreatedId: req.GetCreatedId(),
		Status:    req.GetStatus(),
		Nature:    req.GetNature(),
		SearchKey: req.GetSearchKey(),
		Page:      req.GetPage(),
		PageSize:  req.GetPageSize(),
	})
	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}
	utils2.SendResponse(c, errno.Success, resp.Data, 0, "")
	return
}

// DeleteOrder .
// @router /service/order/delete [POST]
func DeleteOrder(ctx context.Context, c *app.RequestContext) {
	var err error
	var req base.IdReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}

	resp, err := client.OrderClient.DeleteOrder(ctx, &base2.IdReq{Id: req.GetID()})

	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), resp, 0, "")
		return
	}
	utils2.SendResponse(c, errno.Success, resp, 0, "")
	return
}

// CreateOrder .
// @router /service/order/create [POST]
func CreateOrder(ctx context.Context, c *app.RequestContext) {
	var err error
	var req order.CreateOrderReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}
	items := make([]*base2.OrderItem, len(req.GetItems()))

	for _, item := range req.GetItems() {
		items = append(items, &base2.OrderItem{
			ProductId: item.GetProductId(),
			Quantity:  item.GetQuantity(),
			Price:     item.GetPrice(),
			Name:      item.GetName(),
		})
	}

	resp, err := client.OrderClient.CreateOrder(ctx, &order2.CreateOrderReq{
		MemberId:    req.GetMemberId(),
		CreatedId:   req.GetCreatedId(),
		Items:       items,
		TotalAmount: req.GetTotalAmount(),
		UserId:      req.GetUserId(),
	})

	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), resp, 0, "")
		return
	}
	utils2.SendResponse(c, errno.Success, resp.Data, 0, "")
	return
}

// Payment .
// @router /service/order/payment [POST]
func Payment(ctx context.Context, c *app.RequestContext) {
	var err error
	var req order.PaymentReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}

	resp, err := client.OrderClient.Payment(ctx, &order2.PaymentReq{})

	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), resp, 0, "")
		return
	}
	utils2.SendResponse(c, errno.Success, resp.Data, 0, "")
	return
}

// CancelledOrder .
// @router /service/order/cancelled [POST]
func CancelledOrder(ctx context.Context, c *app.RequestContext) {
	var err error
	var req order.CancelledOrderReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}

	resp, err := client.OrderClient.CancelledOrder(ctx, &order2.CancelledOrderReq{
		Id:        req.GetID(),
		Reason:    req.GetReason(),
		CreatedId: req.GetCreatedId(),
	})

	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), resp, 0, "")
		return
	}
	utils2.SendResponse(c, errno.Success, resp, 0, "")
	return
}

// RefundOrder .
// @router /service/order/refund [POST]
func RefundOrder(ctx context.Context, c *app.RequestContext) {
	var err error
	var req order.RefundOrderReq
	err = c.BindAndValidate(&req)
	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), nil, 0, "")
		return
	}
	resp, err := client.OrderClient.RefundOrder(ctx, &order2.RefundOrderReq{
		Id:        req.GetID(),
		Reason:    req.GetReason(),
		CreatedId: req.GetCreatedId(),
		Amount:    req.GetAmount(),
	})

	if err != nil {
		utils2.SendResponse(c, errno.ConvertErr(err), resp, 0, "")
		return
	}
	utils2.SendResponse(c, errno.Success, resp, 0, "")
	return
}
